---

metadata:
  name: &name "mariadb.mdl"
  purpose: "Imagen base para servicios de base de datos MariaDB de la NAC"
  version: "1.0"
  role: "service"
  inheritance: ""
  creation_date: "2026-01-18"
  content:
    - "Servidor de base de datos MariaDB"

applications:
  - group: "repositorios mariadb"
    action: "add"
    description: >
      Repositorio oficial de MariaDB.
      Incluye paquetes para instalaciÃ³n de paquetes de MariaDB.
    urls:
      - "https://dlm.mariadb.com/enterprise-release-helpers/mariadb_es_repo_setup"
  
  - group: "motor base de datos"
    action: "add"
    description: >
      Motor de base de datos MariaDB y herramientas cliente.
    packages:
      - "mariadb-server"
      - "mariadb-client"

security:
  selinux:
    mode: "enforcing"
    process_domain: "mysqld_t"
    policy_module:
      name: "mariadb"
      path: "/usr/share/mariadb/policy/selinux/mariadb.pp"
      required: true
    file_contexts:
      - resource: "datadir"
        context_type: "mysqld_db_t"
      - resource: "logs"
        context_type: "mysqld_log_t"
      - resource: "config"
        context_type: "mysqld_etc_t"
      - resource: "socket"
        context_type: "mysqld_var_run_t"
    port_contexts:
      - port: 3306
        protocol: "tcp"
        context_type: "mysqld_port_t"
    tmpfs_access:
      enabled: false

  encryption:
    cryptography_library:
      provider: "openssl"
    data_in_transit:
      enabled: false
    data_at_rest:
      enabled: false
      key_management_plugin: "file" 

  hardening:
    mariadb_secure_installation:
      remove_anonymous_users: true
      remove_test_database: true
      disallow_root_remote_login: true
    local_infile:
      enabled: false

  firewall:
    policies: 
      input: "denied"
      output: "accept"
      forward: "denied"
    rules:
      - rule: 1
        name: "database access"
        direction: "input"
        protocol: "tcp"
        port: 3306

performance:
  innodb:
    buffer_pool_size: "" # en bytes

  connections:
    max_connections: 151 # default
    thread_handling: "one-thread-per-connection"
    thread_pool_enable: false

  caching:
    table_open_cache: 2000 # default
    table_definition_cache: 2000

services:
  enable:
    - "mariadb"

---
